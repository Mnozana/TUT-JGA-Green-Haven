<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Green Haven Login</title>
    <link rel="stylesheet" href="home.css">
    <link rel="stylesheet" href="login.css">
    <!-- Add Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
</head>
<body>
    <header>
        <div class="logo">Green Haven</div>
        <nav>
            <ul>
                <li><a href="index.html" class="active">Login</a></li>
            </ul>
        </nav>
    </header>

    <main class="login-container">
        <section class="login-hero" style="background-image: url('images/cover.jpg')">
            <div class="login-overlay"></div>
            <div class="login-content">
                <h1>Welcome Back to Green Haven</h1>
                <p>Please login to access your gardening resources</p>
            </div>
        </section>

        <section class="login-form-section">
            <div class="login-form-container">
                <h2>Member Login</h2>
                <form class="login-form" id="loginForm">
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" name="email" placeholder="Enter your email" required>
                        <div id="email-error" class="error-message" style="display: none;"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" name="password" placeholder="Enter your password" required>
                        <div id="password-error" class="error-message" style="display: none;"></div>
                    </div>
                    
                    <div class="form-options">
                        <label class="remember-me">
                            <input type="checkbox" name="remember"> Remember me
                        </label>
                        <a href="forgot-password.html" class="forgot-password">Forgot password?</a>
                    </div>
                    
                    <button type="submit" class="login-button" id="loginButton">
                        <span id="loginText">Login to Your Haven</span>
                        <span id="loginLoading" style="display: none;">Logging in...</span>
                    </button>
                    
                    <div class="register-link">
                        <p>Don't have an account? <a href="signup.html">Create Haven ID</a></p>
                    </div>
                </form>
            </div>
        </section>
    </main>

    <!-- Welcome Animation Overlay -->
    <div class="welcome-animation" id="welcomeAnimation">
        <div class="welcome-icon">ðŸŒ¿</div>
        <h2 class="welcome-message">Welcome Back, Gardener!</h2>
        <p class="welcome-submessage">We're redirecting you to your personal haven</p>
        <div class="countdown" id="countdown">3</div>
    </div>

    <footer>
        <p>&copy; 2025 Green Haven Gardening. All rights reserved.</p>
    </footer>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBwBBfN5LG6RFRezR5cBfcWKv9iKzIdAvA",
			authDomain: "green-haven-tut.firebaseapp.com",
		    databaseURL: "https://green-haven-tut-default-rtdb.firebaseio.com",
		    projectId: "green-haven-tut",
		    storageBucket: "green-haven-tut.firebasestorage.app",
		    messagingSenderId: "30246624131",
		    appId: "1:30246624131:web:e5e151aa0672721512f4b6"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Show error message
        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }

        // Hide error message
        function hideError(elementId) {
            const errorElement = document.getElementById(elementId);
            errorElement.style.display = 'none';
        }

        // Add form validation on submit
        document.getElementById('loginForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            // Get input values
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // Reset error messages
            hideError('email-error');
            hideError('password-error');
            
            // Show loading state
            document.getElementById('loginText').style.display = 'none';
            document.getElementById('loginLoading').style.display = 'inline';
            document.getElementById('loginButton').disabled = true;

            try {
                // Sign in with Firebase Auth
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // Update user's last login timestamp in Firestore
                await db.collection('users').doc(user.uid).update({
                    lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                });

                // Show welcome animation
                const welcomeAnimation = document.getElementById('welcomeAnimation');
                const countdownElement = document.getElementById('countdown');
                
                welcomeAnimation.classList.add('active');
                
                // Start countdown from 3 seconds
                let seconds = 3;
                countdownElement.textContent = seconds;
                
                const countdownInterval = setInterval(() => {
                    seconds--;
                    countdownElement.textContent = seconds;
                    
                    if (seconds <= 0) {
                        clearInterval(countdownInterval);
                        // Redirect to home.html
                        window.location.href = 'home.html';
                    }
                }, 1000);
                
            } catch (error) {
                console.error('Login error:', error);
                
                // Handle different Firebase auth errors
                switch (error.code) {
                    case 'auth/invalid-email':
                        showError('email-error', 'Invalid email address');
                        break;
                    case 'auth/user-disabled':
                        showError('email-error', 'This account has been disabled');
                        break;
                    case 'auth/user-not-found':
                        showError('email-error', 'No account found with this email');
                        break;
                    case 'auth/wrong-password':
                        showError('password-error', 'Incorrect password');
                        break;
                    case 'auth/too-many-requests':
                        showError('password-error', 'Too many failed attempts. Please try again later.');
                        break;
                    default:
                        showError('email-error', 'Login failed. Please try again.');
                }
            } finally {
                // Reset loading state
                document.getElementById('loginText').style.display = 'inline';
                document.getElementById('loginLoading').style.display = 'none';
                document.getElementById('loginButton').disabled = false;
            }
        });

        // Check if user is already logged in
        auth.onAuthStateChanged((user) => {
            if (user) {
                // User is signed in, redirect to home page
                window.location.href = 'home.html';
            }
        });
    </script>
</body>
</html>