<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vegetable Watering Calculator | Green Haven Gardening</title>
    <link rel="stylesheet" href="home.css">
    <link rel="stylesheet" href="calculator.css">
</head>
<body>
    <header>
        <div class="logo">Green Haven</div>
        <nav>
		  <ul class="main-menu">
			<li><a href="home.html">Home</a></li>
			<li><a href="team.html">Team</a></li>
			<li><a href="challenges.html">Challenges</a></li>
			<li><a href="solutions.html">Solutions</a></li>
			<li class="dropdown">
			  <a href="#">Resources</a>
			  <ul class="dropdown-menu">
				<li><a href="irrigation.html">Irrigation Systems</a></li>
				<li class="active"><a href="Vegetable Watering Calculator.html">Calculator</a></li>
				<li><a href="land-sale.html">Land Sale</a></li>
			  </ul>
			</li>
			<li><a href="glossary.html">Glossary</a></li>
		  </ul>
		</nav>
    </header>

    <main>
        <section class="calculator-container">
            <h1>Vegetable Watering Calculator</h1>
            <p>Determine the optimal water amount for your garden based on current temperature and soil conditions</p>
            
            <div class="calculator-form">
                <div>
                    <label for="temperature">Current Temperature (°C):</label>
                    <input type="number" id="temperature" step="0.1" value="20" max="50">
                    <small>Enter temperature between -20°C and 50°C</small>
                </div>
                
                <button class="cta-button" onclick="calculateWater()">Calculate Water Needs</button>
            </div>
            
            <div id="result" class="calculator-results" style="display: none;">
                <h2>Watering Analysis</h2>
                
                <div class="result-item">
                    <div class="reading">
                        <div>Temperature:</div>
                        <div><span id="tempDisplay"></span> °C</div>
                    </div>
                </div>
                
                <div class="result-item">
                    <div class="reading">
                        <div>Current Soil Moisture:</div>
                        <div><span id="moistureDisplay"></span>%</div>
                    </div>
                    <div class="moisture-bar">
                        <div class="moisture-level" id="moistureBar"></div>
                    </div>
                </div>
                
                <div class="result-item">
                    <div class="reading">
                        <div>Moisture Loss Due to Temperature:</div>
                        <div><span id="lossDisplay"></span>%</div>
                    </div>
                </div>
                
                <div class="result-item">
                    <div class="reading">
                        <div>Adjusted Moisture Level:</div>
                        <div><span id="adjustedDisplay"></span>%</div>
                    </div>
                    <div class="moisture-bar">
                        <div class="moisture-level" id="adjustedBar"></div>
                    </div>
                </div>
                
                <div class="result-item">
                    <div class="reading">
                        <div>Water Required:</div>
                        <div><span id="waterDisplay"></span> L/m²</div>
                    </div>
                </div>
                
                <div class="temp-impact" id="tempImpact"></div>
                
                <div id="recommendation" class="alert"></div>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 Green Haven Gardening. All rights reserved.</p>
    </footer>

    <script>
        // Cache to store previous calculations
        let calculationCache = {
            temperature: null,
            results: null
        };
        
        class VegetableWateringSystem {
            // Constants
            static IDEAL_MOISTURE = 50.0;
            static MAX_WATER_PER_SQ_METER = 5.0;
            
            static calculate(temperature, useCache = true) {
                // Check if we have cached results for this temperature
                if (useCache && calculationCache.temperature === temperature && calculationCache.results) {
                    return calculationCache.results;
                }
                
                // If no cache or different temperature, calculate new results
                // Use cached moisture if temperature hasn't changed, otherwise generate new
                let currentMoisture;
                if (calculationCache.temperature === temperature && calculationCache.results) {
                    currentMoisture = calculationCache.results.currentMoisture;
                } else {
                    // Simulate current moisture level (20% to 80% range)
                    currentMoisture = 20 + Math.random() * 60;
                }
                
                // Calculate moisture loss based on temperature
                const moistureLoss = this.calculateMoistureLoss(temperature, currentMoisture);
                const newMoistureLevel = Math.max(0, currentMoisture - moistureLoss);
                
                // Calculate water needed based on both temperature and moisture
                const waterNeeded = this.calculateWaterNeeded(newMoistureLevel, temperature);
                
                const results = {
                    temperature,
                    currentMoisture,
                    moistureLoss,
                    newMoistureLevel,
                    waterNeeded
                };
                
                // Cache the results
                calculationCache = {
                    temperature,
                    results
                };
                
                return results;
            }
            
            static calculateMoistureLoss(temperature, currentMoisture) {
                // Base loss increases with temperature (more impact at higher temps)
                const baseLoss = 1.0;
                
                // Temperature factor has exponential impact
                const tempFactor = 1 + Math.pow(Math.abs(temperature - 20) / 20, 1.5);
                
                // Moisture loss is higher when current moisture is higher
                const moistureFactor = 0.5 + (currentMoisture / 100);
                
                // Calculate total moisture loss
                let moistureLoss = baseLoss * tempFactor * moistureFactor;
                
                // Adjust for extremely low temperatures (less evaporation)
                if (temperature < 5) {
                    moistureLoss *= 0.5;
                }
                
                // Adjust for extremely high temperatures (more evaporation)
                if (temperature > 30) {
                    moistureLoss *= 1.5;
                }
                
                // Cap moisture loss at very high temperatures
                if (temperature > 40) {
                    moistureLoss = Math.min(moistureLoss, 15); // Maximum 15% loss
                }
                
                return Math.max(0, moistureLoss.toFixed(1));
            }
            
            static calculateWaterNeeded(moistureLevel, temperature) {
                if (moistureLevel >= this.IDEAL_MOISTURE) return 0;
                
                // Calculate base deficit
                const deficit = this.IDEAL_MOISTURE - moistureLevel;
                
                // Temperature increases water needs (more at extremes)
                const tempMultiplier = 1 + (Math.abs(temperature - 20) / 30);
                
                // Calculate water needed
                const waterNeeded = (deficit / 10) * this.MAX_WATER_PER_SQ_METER * tempMultiplier;
                
                // Cap water needed at very high temperatures
                if (temperature > 40) {
                    return Math.min(waterNeeded, this.MAX_WATER_PER_SQ_METER * 1.2).toFixed(1);
                }
                
                return Math.min(waterNeeded, this.MAX_WATER_PER_SQ_METER).toFixed(1);
            }
        }

        function calculateWater() {
            const temperatureInput = document.getElementById('temperature');
            const temperature = parseFloat(temperatureInput.value);
            
            if (isNaN(temperature)) {
                alert("Please enter a valid temperature value");
                return;
            }
            
            // Validate temperature range
            if (temperature < -20 || temperature > 50) {
                alert("Temperature must be between -20°C and 50°C");
                temperatureInput.value = Math.max(-20, Math.min(50, temperature)); // Clamp value
                return;
            }
            
            // Check if temperature hasn't changed
            const useCache = calculationCache.temperature === temperature;
            
            const results = VegetableWateringSystem.calculate(temperature, useCache);
            const resultDiv = document.getElementById('result');
            
            document.getElementById('tempDisplay').textContent = results.temperature.toFixed(1);
            document.getElementById('moistureDisplay').textContent = results.currentMoisture.toFixed(1);
            document.getElementById('lossDisplay').textContent = results.moistureLoss.toFixed(1);
            document.getElementById('adjustedDisplay').textContent = results.newMoistureLevel.toFixed(1);
            document.getElementById('waterDisplay').textContent = results.waterNeeded;
            
            // Update moisture bars
            document.getElementById('moistureBar').style.width = `${results.currentMoisture}%`;
            document.getElementById('adjustedBar').style.width = `${results.newMoistureLevel}%`;
            
            // Add temperature impact information
            const tempImpact = document.getElementById('tempImpact');
            if (temperature < 10) {
                tempImpact.textContent = "Low temperature reduces evaporation and water needs.";
            } else if (temperature > 40) {
                tempImpact.textContent = "Extreme high temperature significantly increases evaporation and water requirements.";
            } else if (temperature > 30) {
                tempImpact.textContent = "High temperature significantly increases evaporation and water requirements.";
            } else {
                tempImpact.textContent = "Moderate temperature has balanced impact on water needs.";
            }
            
            // Add cache indicator
            if (useCache) {
                tempImpact.textContent += " (Using previous soil moisture data)";
            } else {
                tempImpact.textContent += " (New soil moisture measurement)";
            }
            
            // Special warning for extreme temperatures
            if (temperature > 40) {
                tempImpact.textContent += " WARNING: Extreme temperatures may damage plants!";
                tempImpact.style.color = "#d32f2f";
                tempImpact.style.fontWeight = "bold";
            } else {
                tempImpact.style.color = "";
                tempImpact.style.fontWeight = "";
            }
            
            const recommendation = document.getElementById('recommendation');
            if (results.newMoistureLevel < 25) {
                recommendation.textContent = `CRITICAL: Soil is extremely dry! Water immediately. ${temperature > 25 ? "High temperatures are accelerating moisture loss." : ""}`;
                recommendation.className = "alert alert-warning";
            } else if (results.newMoistureLevel < 35) {
                recommendation.textContent = `Warning: Soil is dry. Water today. ${temperature > 25 ? "Elevated temperatures are increasing water requirements." : ""}`;
                recommendation.className = "alert alert-warning";
            } else if (results.newMoistureLevel > 75) {
                recommendation.textContent = `Warning: Soil is waterlogged! Avoid watering. ${temperature > 25 ? "Despite high temperatures, soil has sufficient moisture." : ""}`;
                recommendation.className = "alert alert-warning";
            } else if (results.newMoistureLevel > 60) {
                recommendation.textContent = `Soil moisture is good. ${temperature > 25 ? "Monitor closely as high temperatures may increase water needs." : "Maintain current watering schedule."}`;
                recommendation.className = "alert alert-info";
            } else if (results.newMoistureLevel >= 45 && results.newMoistureLevel <= 55) {
                recommendation.textContent = `Ideal moisture level maintained. ${temperature > 25 ? "High temperatures may require slightly more frequent watering." : ""}`;
                recommendation.className = "alert alert-success";
            } else {
                recommendation.textContent = `Soil moisture is adequate. ${temperature > 25 ? "Increase watering frequency due to high temperatures." : "Continue with normal watering schedule."}`;
                recommendation.className = "alert alert-info";
            }
            
            // Add special recommendation for extreme temperatures
            if (temperature > 40) {
                recommendation.textContent += " Consider providing shade and extra water to protect plants from heat stress.";
            }
            
            resultDiv.style.display = 'block';
        }
        
        // Add input validation to prevent temperatures above 50
        document.getElementById('temperature').addEventListener('change', function() {
            const temperature = parseFloat(this.value);
            if (!isNaN(temperature) && temperature > 50) {
                alert("Temperature cannot exceed 50°C");
                this.value = 50;
            }
            if (!isNaN(temperature) && temperature < -20) {
                alert("Temperature cannot be below -20°C");
                this.value = -20;
            }
        });
    </script>
</body>
</html>